---
title: "ETC2420 Group 53"
authors: "Sineth Wickramsinghe, Janiru Rathnapriya, Senuth Dias, Lawrence"
output: html_document
date: "2024-09-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE, error = FALSE)
library(tidyverse)
library(broom)
library(gridExtra)
library(MASS)

# Creates a histogram and smoothed histogram given a vector of values.
dataplot <- function(x, bins = 50, colour = "blue") {
  ggplot(tibble(x = x), aes(x = x, y = after_stat(density))) +
    geom_histogram(bins = bins, colour = colour, fill = colour, alpha = 0.2) +
    geom_density(colour = colour, fill = colour, alpha = 0.2) +
    theme_bw()
}

set.seed(24205242)
```

```{r Reading Bank Survey Data}
bank <- read_csv("banksurvey.csv")
head(bank)
```

# **Task #1**

### Descriptive Statistics on Customer Income

```{r Descriptive Statistics}

summary(bank$income) #Provides descriptive stats of customer income 
sd(bank$income) #Standard deviation of customer income 
```
### Visualising the Customer Income ($) Data 

```{r Visualising Data}
dataplot(bank$income) + 
  xlab("Customer Income ($)") + 
  ylab("Frequency") + 
  ggtitle("Distribution of Customer Income ($)") + 
  theme(plot.title = element_text(hjust = 0.5))
```


### Fitting Customer Income to Various Models

```{r Fitting Customer Income to Varuous Models}
normal_fit <- fitdistr(bank$income, "normal")
normal_fit %>% tidy()

exponential_fit <- fitdistr(bank$income, "exponential") 
exponential_fit %>% tidy()

gamma_fit <- fitdistr(bank$income, "gamma") 
gamma_fit %>% tidy()
```

### Normal Distribution QQ Plot Customer Income ($) 

```{r}
qqnorm(bank$income, 
       main = "Normal QQ Plot Cusomter Income ($)",
       xlab = "Theoretical Quantiles (Normal Distribution)", 
       ylab = "Sample (Customer Income)")
qqline(bank$income, col = "red") 
```

### Exponential Distribution QQ Plot Customer Income ($) 


```{r}
qqplot(qexp(ppoints(length(bank$income)), rate = exponential_fit$estimate), bank$income, 
       main = "Exponential QQ Plot Cusomter Income ($)",
       xlab = "Theoretical Quantiles (Exponential Distribution)", 
       ylab = "Sample (Customer Income)")
abline(0, 1, col = "red")
```



### Gamma Distribution QQ Plot Customer Income ($) 


```{r}
qqplot(qgamma(ppoints(length(bank$income)), shape = gamma_fit$estimate["shape"], rate = gamma_fit$estimate["rate"]), bank$income, 
       main = "Gamma QQ Plot Cusomter Income ($)",
       xlab = "Theoretical Quantiles (Gamma Distribution)", 
       ylab = "Sample (Customer Income)") 

abline(0, 1, col = "red")
```



## **Task 2**

### Estimating 80th Percentile of Customer Income ($) using quantile() R function 

```{r}
normal_80th_percentile <- qnorm(0.8, mean = normal_fit$estimate[1], sd =normal_fit$estimate[2])
exponential_80th_percentile <- qexp(0.8, rate = exponential_fit$estimate)
gamma_80th_percentile <- qgamma(0.8, shape = gamma_fit$estimate[1], rate = gamma_fit$estimate[2])
sample_80th_percentile <- quantile(bank$income, probs = 0.8, type = 7)

tibble(normal_80th_percentile, exponential_80th_percentile, gamma_80th_percentile, sample_80th_percentile)
```




```{r}
B <- 5000
norm_quant <- matrix(nrow = B, ncol = 1)

for (b in 1:B) {
  temp <- sample(bank$income, replace = TRUE)
  fit <- fitdistr(temp, "normal")
  
  norm_quant[b,] <- qnorm(0.8, fit$estimate[1], fit$estimate[2])
}

normal_80th_percentiles <- quantile(norm_quant, c(0.025, 0.975))

normal_80th_percentiles
```


```{r}
B <- 5000
exp_quant <- matrix(nrow = B, ncol = 1)

for (b in 1:B) {
  temp <- sample(bank$income, replace = TRUE)
  fit <- fitdistr(temp, "exponential")
  
  exp_quant[b,] <- qexp(0.8, fit$estimate)
}

exponential_80th_percentiles <- quantile(exp_quant, c(0.025, 0.975))
exponential_80th_percentiles
```

```{r}
B <- 5000
gamma_quant <- matrix(nrow = B, ncol = 1)

for (b in 1:B) {
  temp <- sample(bank$income, replace = TRUE)
  fit <- fitdistr(temp, "gamma")
  
  gamma_quant[b,] <- qgamma(0.8, fit$estimate[1], fit$estimate[2])
}

gamma_80th_percentiles <- quantile(gamma_quant, c(0.025, 0.975))
gamma_80th_percentiles
```

```{r}
B <- 5000
quant <- matrix(nrow = B, ncol = 1)

for (b in 1:B) {
  temp <- sample(bank$income, replace = TRUE)
  quant[b,] <- quantile(temp, probs = 0.8, type = 7)
}

sample_80th_percentiles <- quantile(quant, c(0.025, 0.975))
```

```{r}
tibble(normal_80th_percentiles, exponential_80th_percentiles, gamma_80th_percentiles, sample_80th_percentiles)
```

beep

## **Task 3**

```{r}
# Set parameters
set.seed(123)  # For reproducibility
mean_income <- 100000
lambda <- 1 / mean_income
B <- 5000  # Number of bootstrap samples
n <- 200  # Sample size for each bootstrap sample

# Initialize vectors to store the 80th percentiles
normal_80th_percentiles <- numeric(B)
exponential_80th_percentiles <- numeric(B)
gamma_80th_percentiles <- numeric(B)
sample_80th_percentiles <- numeric(B)

# Simulate sampling distribution
for (b in 1:B) {
  # Generate a sample from the exponential distribution
  sample_data <- rexp(n, rate = lambda)
  
  # Fit models to the sampled data
  normal_fit <- fitdistr(sample_data, "normal")
  exponential_fit <- fitdistr(sample_data, "exponential")
  gamma_fit <- fitdistr(sample_data, "gamma")
  
  # Calculate the 80th percentiles for each model
  normal_80th_percentiles[b] <- qnorm(0.8, mean = normal_fit$estimate[1], sd = normal_fit$estimate[2])
  exponential_80th_percentiles[b] <- qexp(0.8, rate = exponential_fit$estimate)
  gamma_80th_percentiles[b] <- qgamma(0.8, shape = gamma_fit$estimate[1], rate = gamma_fit$estimate[2])
  sample_80th_percentiles[b] <- quantile(sample_data, probs = 0.8, type = 7)
}

# Calculate the bias and standard deviation for each estimator
bias_normal <- mean(normal_80th_percentiles) - qexp(0.8, rate = lambda)
bias_exponential <- mean(exponential_80th_percentiles) - qexp(0.8, rate = lambda)
bias_gamma <- mean(gamma_80th_percentiles) - qexp(0.8, rate = lambda)
bias_sample <- mean(sample_80th_percentiles) - qexp(0.8, rate = lambda)

sd_normal <- sd(normal_80th_percentiles)
sd_exponential <- sd(exponential_80th_percentiles)
sd_gamma <- sd(gamma_80th_percentiles)
sd_sample <- sd(sample_80th_percentiles)

# Summary of results
results <- tibble(
  Estimator = c("Normal", "Exponential", "Gamma", "Sample Quantile"),
  Bias = c(bias_normal, bias_exponential, bias_gamma, bias_sample),
  Standard_Deviation = c(sd_normal, sd_exponential, sd_gamma, sd_sample)
)

print(results)

# Plotting the distributions
library(ggplot2)

# Combine the data into a single data frame for plotting
plot_data <- tibble(
  Percentile = c(normal_80th_percentiles, exponential_80th_percentiles, gamma_80th_percentiles, sample_80th_percentiles),
  Estimator = factor(rep(c("Normal", "Exponential", "Gamma", "Sample Quantile"), each = B))
)

ggplot(plot_data, aes(x = Percentile, fill = Estimator)) +
  geom_density(alpha = 0.5) +
  labs(title = "Sampling Distributions of 80th Percentiles", x = "80th Percentile", y = "Density") +
  theme_minimal()
```



## **Task 4**


## **Task 5**
